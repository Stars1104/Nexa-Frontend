<!DOCTYPE html>
<html>
<head>
    <title>Debug Authentication</title>
</head>
<body>
    <h1>Authentication Debug</h1>
    <div id="debug-info"></div>
    
    <script>
        function debugAuth() {
            const debugInfo = document.getElementById('debug-info');
            
            // Check localStorage
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            const persistRoot = localStorage.getItem('persist:root');
            
            let html = '<h2>LocalStorage Data:</h2>';
            html += `<p><strong>Token:</strong> ${token ? token.substring(0, 20) + '...' : 'Not found'}</p>`;
            html += `<p><strong>User:</strong> ${user ? 'Found' : 'Not found'}</p>`;
            html += `<p><strong>Persist Root:</strong> ${persistRoot ? 'Found' : 'Not found'}</p>`;
            
            // Check Redux state
            if (persistRoot) {
                try {
                    const parsedState = JSON.parse(persistRoot);
                    const authState = JSON.parse(parsedState.auth || '{}');
                    html += '<h2>Redux Auth State:</h2>';
                    html += `<p><strong>Auth Token:</strong> ${authState.token ? 'Found' : 'Not found'}</p>`;
                    html += `<p><strong>Auth User:</strong> ${authState.user ? 'Found' : 'Not found'}</p>`;
                } catch (e) {
                    html += '<p><strong>Redux Parse Error:</strong> ' + e.message + '</p>';
                }
            }
            
            // Test API call
            html += '<h2>API Test:</h2>';
            if (token) {
                fetch('/api/payment/subscription-status', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    html += `<p><strong>API Response Status:</strong> ${response.status}</p>`;
                    return response.json();
                })
                .then(data => {
                    html += `<p><strong>API Response Data:</strong> ${JSON.stringify(data, null, 2)}</p>`;
                    debugInfo.innerHTML = html;
                })
                .catch(error => {
                    html += `<p><strong>API Error:</strong> ${error.message}</p>`;
                    debugInfo.innerHTML = html;
                });
            } else {
                html += '<p><strong>No token available for API test</strong></p>';
                debugInfo.innerHTML = html;
            }
        }
        
        // Run debug on page load
        window.onload = debugAuth;
    </script>
</body>
</html>
